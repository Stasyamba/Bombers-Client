<?xml version="1.0" encoding="utf-8"?>
<s:Panel xmlns:mx="library://ns.adobe.com/flex/mx"
         xmlns:mx1="library://ns.adobe.com/flex/halo"
         xmlns:s="library://ns.adobe.com/flex/spark"
         xmlns:fx="http://ns.adobe.com/mxml/2009"
         creationComplete="panelCreationComplete();"
         borderVisible="false"
         dropShadowVisible="false"
         skinClass="skins.common.EmptyPopUpS"
         xmlns:flexcomponents="components.common.flexcomponents.*"
         xmlns:create="components.pages.game.windows.create.*"
        >
    <fx:Script>
		<![CDATA[
        ]]>
	</fx:Script>

    <fx:Declarations>

        <s:Animate id="disapearingAnimation" target="{this}" duration="300"
                   effectEnd="{close();}">
            <s:SimpleMotionPath property="alpha"
                                valueFrom="1"
                                valueTo="0"
                    />
        </s:Animate>

        <s:Animate id="apearingAnimation" target="{this}" duration="1200">
            <s:SimpleMotionPath property="alpha"
                                valueFrom="0" valueTo="1"
                    />
        </s:Animate>

    </fx:Declarations>

    <fx:Script>
		<![CDATA[
        import components.common.game.multygameresult.GameResults
        import components.common.game.multygameresult.Result
        import components.common.items.ItemProfileObject
        import components.common.utils.adjustcolor.Color
        import components.common.utils.adjustcolor.ColorMatrix
        import components.common.utils.adjustcolor.ColorMatrixObject

        import mx.managers.PopUpManager

        public var gameResults:GameResults;

        public function close():void {
            PopUpManager.removePopUp(this);
        }

        public function closeWrapper():void {
            disapearingAnimation.play();
        }

        private function panelCreationComplete():void {
            apearingAnimation.play();

            var cm:ColorMatrix = new ColorMatrix();
            var cmo:ColorMatrixObject = new ColorMatrixObject(0, 0, null, 0, new Color(-20, -20, -20));
            cm.applyColorMatrixObject(cmo);

            var cm1:ColorMatrix = new ColorMatrix();
            var cmo1:ColorMatrixObject = new ColorMatrixObject(0, 0);
            cm1.applyColorMatrixObject(cmo1);

            lightBorderContainer.filters = [cm1.filter];
            darkBorderContainer.filters = [cm.filter];

            // fill the results

            resultsVGroup.removeAllElements();

            var place:int = 1;
            for each(var r:Result in gameResults.getResults()) {
                var l:Label = new Label();
                l.text = place.toString() + ". " + r.gameProfile.name;
                l.minWidth = 180;
                l.setStyle("fontFamily", "mpbc");


                if (Context.Model.currentSettings.ownGameProfile.id == r.gameProfile.id) {
                    l.setStyle("fontSize", 18);
                    l.setStyle("color", 0xfbb044);
                } else {
                    l.setStyle("fontSize", 14);
                    l.setStyle("color", 0xffffff);

                }

                resultsVGroup.addElement(l);

                place++;
            }

            for each(var i:ItemProfileObject in gameResults.getItems()) {

            }

        }
        ]]>
	</fx:Script>
    <s:layout>
        <s:BasicLayout/>
    </s:layout>

    <s:BorderContainer id="lightBorderContainer"
                       backgroundImage="@Embed(source='assets/windows/global/inventory/patternBG.jpg')"
                       backgroundImageFillMode="repeat"
                       width="335" height="310"
                       borderVisible="false"
            />

    <s:BorderContainer id="darkBorderContainer"
                       backgroundImage="@Embed(source='assets/windows/global/inventory/patternBG.jpg')"
                       backgroundImageFillMode="repeat"
                       width="319" height="294"
                       borderVisible="false"
                       x="8" y="8"
            />

    <s:VGroup width="319" height="294"
              x="8" y="8"
              horizontalAlign="center"
              verticalAlign="middle"
            >
        <s:Label text="Результаты:" fontFamily="mpbc" fontSize="24" color="0xffffff"/>
        <s:VGroup id="resultsVGroup"/>
        <s:Label text="Собрали: " fontFamily="mpbc" fontSize="24" color="0xffffff"/>
        <s:HGroup id="collectItemsHGroup"/>
    </s:VGroup>

    <flexcomponents:CloseButton skinClass="skins.buttons.CloseButtonBlackS"
                                x="290" y="10"
                                click="closeWrapper();"
            />

    <s:controlBarContent/>
</s:Panel>